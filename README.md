# DeviceStatAPI

Сервис для учета и анализа данных, поступающих с устройств.

## Описание

Сервис реализует REST API на FastAPI для приёма статистики от устройств, её хранения и последующего анализа.  
Каждое устройство передаёт в систему координаты `x`, `y`, `z`, которые сохраняются в базу данных вместе с временной меткой.

## Возможности

- Сбор статистики с устройств в формате:
  ```
  {
    "x": float,
    "y": float,
    "z": float
  }
- Получение аналитики по данным:
  1) минимальное значение
  2) максимальное значение
  3) количество
  4) сумма
  5) медиана

Анализ может быть получен за указанный период (по временным меткам) либо за всё время

##Энд-поинты
1) POST /devices - Создание нового устройства
2) POST /stats - Добавление новой записи статистики для устройства
3) GET /stats/{device_id} - Получение статистики устройства за заданный период или за все время
4) GET /stats/analysis/{device_id} - Синхронный анализ данных устройства
5) POST /stats/analysis/{device_id}/async - Попытка сделать асинхронный запуск анализа данных устройства (с использованием Celery) (PS. Сидел почти сутки, пытался разобраться что не так, как мне кажется, я был близко, но он так и не понял почему он не хочет видеть таблицу.)
6) GET /stats/analysis/result/{device_id} - Получение ранее сохранённых результатов асинхронного анализа для устройства.

## Используемые технологии
-  Python 3.11
-  FastAPI
-  PostgreSQL
-  SQLAlchemy (async)
-  Docker + Docker Compose

## Структура проекта
```
.
├── app/
│   ├── api/            # Роуты
│   ├── core/           # Настройки
│   ├── crud/           # Работа с БД
│   ├── db/             # Подключение к БД
│   ├── models/         # Модели SQLAlchemy
│   ├── schemas/        # Pydantic-схемы
│   ├── tasks/          # Попытка анализа статистики в асинхронном режиме (Celery*)
│   ├── utils/          # Дополнительный функции
│   └── main.py         # Точка входа
├── Dockerfile
├── docker-compose.yml
├── requirements.txt
└── README.md
```

 Запуск
1) Клонировать репозиторий:
```
git clone https://github.com/fin1kk/DeviceStatAPI.git
cd DeviceStatAPI
```

2) Запустить с помощью Docker:
```
docker-compose up --build
```
3) Запустить создание БД:
```
docker compose exec web python -m app.db.init_db
```
Приложение будет доступно по адресу:
 http://localhost:8000/docs

## Автор
Orlov Artem
